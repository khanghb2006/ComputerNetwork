<!DOCTYPE html>
<html lang="vi">
<head>
    <title>HBK-CNet Agent Controller - Full Control</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <header>
        <h1><i class="fas fa-satellite-dish"></i> Remote Agent Control</h1>
        <div id="connection-status" class="status-disconnected">Core: Disconnected</div>
    </header>

    <main class="master-detail-layout">
        
        <aside class="sidebar">
            <h2><i class="fas fa-bars"></i> Chức năng Chính</h2>
            <button class="menu-btn primary" data-view="application">
                <i class="fas fa-desktop"></i> Quản lý Ứng dụng
            </button>
            <button class="menu-btn" data-view="process">
                <i class="fas fa-microchip"></i> Quản lý Process
            </button>
            <button class="menu-btn" data-view="screenshot">
                <i class="fas fa-camera"></i> Screenshot
            </button>
            <button class="menu-btn" data-view="keylogger">
                <i class="fas fa-keyboard"></i> Keylogger
            </button>
            <button class="menu-btn" data-view="system">
                <i class="fas fa-power-off"></i> Điều khiển Hệ thống
            </button>
            <button class="menu-btn" data-view="logs">
                <i class="fas fa-clipboard-list"></i> System Logs
            </button>
        </aside>

        <section class="content-area">

            <div id="welcome-view" class="content-view active">
                <h2><i class="fas fa-home"></i> Chào mừng đến với HBK-CNet Agent Controller</h2>
                <p>Chọn một chức năng từ thanh bên để bắt đầu điều khiển từ xa.</p>
                <div class="tip-box">
                    <strong>Tình trạng kết nối:</strong>
                    Kiểm tra trạng thái kết nối Core Server ở góc trên cùng. Server C++ phải chạy trước khi Node.js Proxy chạy.
                </div>
            </div>

            <div id="application-view" class="content-view">
                <h2><i class="fas fa-desktop"></i> Quản lý Ứng dụng</h2>
                
                <div class="control-box" style="margin-bottom: 20px;">
                    <h3>Điều khiển Ứng dụng (Start / Stop)</h3>
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 300px;">
                            <label for="app-name-input">Tên App (.exe) hoặc Path để chạy:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="app-name-input" placeholder="ví dụ: notepad.exe" style="flex: 1;">
                                <button class="action-btn success" onclick="startApp()" style="margin: 0;">
                                    <i class="fas fa-play"></i> Chạy
                                </button>
                            </div>
                        </div>
                        <div style="flex: 1; min-width: 300px;">
                            <label for="app-id-input">Tên EXE, Path hoặc PID để dừng:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="app-id-input" placeholder="ví dụ: chrome.exe" style="flex: 1;">
                                <button class="action-btn danger" onclick="stopApp()" style="margin: 0;">
                                    <i class="fas fa-stop"></i> Dừng
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-box">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h3 style="margin: 0; border: none;">Danh sách Ứng dụng đang chạy</h3>
                        <button class="action-btn" onclick="sendCommand('application list')">
                            <i class="fas fa-sync-alt"></i> Tải lại danh sách
                        </button>
                    </div>
                    
                    <div class="result-area">
                        <table id="app-table" class="data-table" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th style="width: 15%;">PID</th>
                                    <th style="width: 85%;">Tên Ứng dụng / Path</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="process-view" class="content-view">
                <h2><i class="fas fa-microchip"></i> Quản lý Process</h2>
                <button class="action-btn" onclick="sendCommand('process list')">
                    <i class="fas fa-sync-alt"></i> Tải lại danh sách Process
                </button>
                <div class="result-area mt-15">
                    <table id="process-table" class="data-table">
                        <thead>
                            <tr>
                                <th>PID</th>
                                <th>Tên Process</th>
                                <th>Sử dụng RAM</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="screenshot-view" class="content-view">
                <h2><i class="fas fa-camera"></i> Chụp Màn hình</h2>
                <p>Yêu cầu Agent chụp và gửi lại màn hình dưới dạng ảnh Base64.</p>
                <button class="action-btn primary" onclick="sendCommand('screenshot capture')">
                    <i class="fas fa-camera"></i> CHỤP MÀN HÌNH NGAY
                </button>
                
                <div class="result-area mt-15">
                    <h3>Ảnh Màn hình Đã Chụp</h3>
                    <div id="screenshot-viewer" class="image-container">
                        <p>Ảnh chụp sẽ xuất hiện ở đây sau khi Agent gửi về...</p>
                    </div>
                </div>
            </div>

            <div id="keylogger-view" class="content-view">
                <h2><i class="fas fa-keyboard"></i> Keylogger & Hook</h2>
                <div class="flex-controls">
                    <button class="action-btn success" onclick="sendCommand('keylogger start')">
                        <i class="fas fa-play-circle"></i> Bắt đầu
                    </button>
                    <button class="action-btn danger" onclick="sendCommand('keylogger stop')">
                        <i class="fas fa-stop-circle"></i> Dừng
                    </button>
                </div>
                <div class="result-area mt-15">
                    <h3>Dữ liệu Keylogger</h3>
                    <textarea id="key-log" readonly></textarea>
                </div>
            </div>

            <div id="system-view" class="content-view">
                <h2><i class="fas fa-power-off"></i> Điều khiển Hệ thống</h2>
                <div class="system-control-grid">
                    <button class="large-btn danger" onclick="sendCommand('system shutdown')">
                        <i class="fas fa-power-off"></i> SHUTDOWN
                    </button>
                    <button class="large-btn warning" onclick="sendCommand('system restart')">
                        <i class="fas fa-redo-alt"></i> RESTART
                    </button>
                    <button class="large-btn primary" onclick="sendCommand('system logoff')">
                        <i class="fas fa-sign-out-alt"></i> LOG OFF
                    </button>
                </div>
            </div>

            <div id="logs-view" class="content-view">
                <h2><i class="fas fa-clipboard-list"></i> System Logs</h2>
                <textarea id="system-log-output" readonly></textarea>
            </div>
            
        </section>
    </main>
    
    <script>
        function showView(viewId) {
            document.querySelectorAll('.content-view').forEach(view => {
                view.classList.remove('active');
                view.style.display = 'none';
            });
            document.getElementById(viewId + '-view').style.display = 'block';
            document.getElementById(viewId + '-view').classList.add('active');
            document.querySelectorAll('.menu-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-view="${viewId}"]`).classList.add('active');
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.menu-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const target = e.currentTarget.getAttribute('data-view') ? e.currentTarget : e.target.closest('.menu-btn');
                    const viewId = target.getAttribute('data-view');
                    if (viewId) showView(viewId);
                });
            });
            showView('welcome');
        });

        function startApp() {
            const appName = document.getElementById('app-name-input').value;
            if (appName) {
                sendCommand(`application start ${appName}`);
                document.getElementById('app-name-input').value = ''; 
            }
        }
        function stopApp() {
            const appId = document.getElementById('app-id-input').value;
            if (appId) {
                sendCommand(`application stop ${appId}`);
                document.getElementById('app-id-input').value = ''; 
            }
        }
    </script>
    <script src="script.js"></script>
</body>
</html>